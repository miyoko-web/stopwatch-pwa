<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ストップウォッチPWA</title>
<style>
  body {
    background-color: #121212;
    color: #fff;
    font-family: sans-serif;
    text-align: center;
    padding: 20px;
  }
  button {
    margin: 5px;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
  }
  .green { background-color: #4CAF50; color: white; }
  .gray { background-color: gray; color: white; }
  .orange { background-color: #d2691e; color: white; }

  @media (prefers-color-scheme: dark) {
    #elapsed-time,
    #cycle-time-label {
      color: white !important;
    }
  }
</style>
</head>
<body>

<h2 id="elapsed-time">経過時間: 0.0秒</h2>
<h3 id="production-count">生産数: 0</h3>
<h3 id="cycle-time-label">サイクルタイム: 1.2秒</h3>

<div>
  <button class="orange" onclick="setCycle(1)">1秒</button>
  <button class="orange" onclick="setCycle(2)">2秒</button>
  <button class="orange" onclick="setCycle(3)">3秒</button>
  <button class="orange" onclick="setCycle(5)">5秒</button>
  <button class="orange" onclick="setCycle(10)">10秒</button>
  <button class="orange" onclick="setCycle(15)">15秒</button>
</div>

<div>
  <label><input type="checkbox" id="enable-beep" checked> カウント音</label>
  <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.8">
</div>

<div>
  <button class="green" onclick="start()">スタート</button>
  <button class="gray" onclick="reset()">リセット</button>
</div>

<script>
let startTime, timerInterval;
let productionCount = 0;
let cycleTime = 1.2;
let beepEnabled = true;
let volume = 0.8;

document.getElementById('enable-beep').addEventListener('change', e => {
  beepEnabled = e.target.checked;
});
document.getElementById('volume-control').addEventListener('input', e => {
  volume = parseFloat(e.target.value);
});

function setCycle(sec) {
  cycleTime = sec;
  document.getElementById('cycle-time-label').textContent = `サイクルタイム: ${sec}秒`;
}

function start() {
  startTime = Date.now();
  timerInterval = setInterval(updateTime, 100);
}

function reset() {
  clearInterval(timerInterval);
  productionCount = 0;
  document.getElementById('elapsed-time').textContent = `経過時間: 0.0秒`;
  document.getElementById('production-count').textContent = `生産数: 0`;
}

function updateTime() {
  let elapsedSec = (Date.now() - startTime) / 1000;
  document.getElementById('elapsed-time').textContent = `経過時間: ${elapsedSec.toFixed(1)}秒`;
  if (elapsedSec >= (productionCount + 1) * cycleTime) {
    productionCount++;
    document.getElementById('production-count').textContent = `生産数: ${productionCount}`;
    if (beepEnabled) playBeep();
  }
}

function playBeep() {
  let ctx = new (window.AudioContext || window.webkitAudioContext)();
  let osc = ctx.createOscillator();
  let gain = ctx.createGain();
  osc.type = 'square';
  osc.frequency.value = 880;
  gain.gain.value = volume;
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + 0.1);
}
</script>

</body>
</html>
